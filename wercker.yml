box: ubuntu:latest
build:
    steps:
        - install-packages:
            packages: git

        - script:
            name: install acbuild
            code: |
                git clone git@github.com:appc/acbuild
                ./acbuild/build
                cp -av acbuild/bin/* ./

        - script:
            name: build aci
            code: |
                ./acbuild begin
                ./acbuild dependency add docker://nginx
                ./acbuild write kubernetes-proxy.aci
                ./acbuild end

    after-steps:
        - slack-notifier:
            url: $SLACK_URL
            username: wercker

deploy:
    steps:
        - github-create-release:
            token: $GITHUB_TOKEN
            tag: v0.0.1

        - github-upload-asset:
            token: $GITHUB_TOKEN
            file: kubernetes-proxy.aci

    after-steps:
        - slack-notifier:
            url: $SLACK_URL
            username: wercker

box: golang:1.4
build:
    steps:
        - script:
            name: install acbuild
            code: |
                git clone https://github.com/appc/acbuild.git
                cd acbuild
                ./build
                mv bin/ ../

        - script:
            name: fetch confd
            code: |
                wget https://github.com/kelseyhightower/confd/releases/download/v0.10.0/confd-0.10.0-linux-amd64
                chmod +x confd

        - script:
            name: build aci
            code: |
                ./bin/acbuild begin
                ./bin/acbuild dependency add quay.io/fermayo/ubuntu
                ./bin/acbuild copy boot.sh /opt/boot.sh
                ./bin/acbuild copy confd /usr/local/bin/confd
                ./bin/acbuild run -- apt-get update
                ./bin/acbuild run -- apt-get -y install nginx
                ./bin/acbuild set-exec /opt/boot.sh
                ./bin/acbuild set-name blau-io/kubernetes-proxy
                ./bin/acbuild write kubernetes-proxy.aci
                ./bin/acbuild end

    after-steps:
        - slack-notifier:
            url: $SLACK_URL
            username: wercker

deploy:
    steps:
        - github-create-release:
            token: $GITHUB_TOKEN
            tag: v0.0.1

        - github-upload-asset:
            token: $GITHUB_TOKEN
            file: kubernetes-proxy.aci

    after-steps:
        - slack-notifier:
            url: $SLACK_URL
            username: wercker
